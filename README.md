# Mosi圖片轉房間數據產生器 - 純前端版本

## 概述

這是一個完全在瀏覽器中運行的 Mosi 圖片轉房間數據產生器，無需任何伺服器或 Python 環境。所有圖片處理都在客戶端完成，確保隱私和便利性。

## 主要特點

✨ **純前端運行** - 無需伺服器，直接在瀏覽器中運行
🔒 **隱私保護** - 所有圖片處理都在本地完成，不會上傳到任何伺服器
🚀 **即時處理** - 使用 Canvas API 進行快速圖片處理
📱 **響應式設計** - 支援桌面和移動設備
🎨 **智能建議** - 自動計算建議的精靈尺寸
🔄 **房間合併** - 支援多個房間數據的合併功能
⚡ **自動計算** - 修改精靈尺寸或房間尺寸時自動計算另一個欄位

## 使用方法

### 1. 基本使用

1. **開啟網頁**
   - 直接雙擊 `index_standalone.html` 檔案
   - 或在瀏覽器中開啟該檔案

2. **載入圖片**
   - 點擊「選擇檔案」按鈕
   - 選擇要轉換的圖片（支援 PNG、JPG、JPEG 格式）
   - 點擊「載入圖片」按鈕

3. **設定參數**
   - **精靈設定**：設定精靈名稱、尺寸、屬性等
   - **房間設定**：設定房間名稱、尺寸等
   - 系統會自動建議合適的精靈尺寸
   - **自動計算**：修改精靈尺寸會自動計算房間尺寸，反之亦然

4. **生成數據**
   - 點擊「生成數據」按鈕
   - 查看生成的 JSON 數據
   - 點擊「下載.JSON文件」保存結果

### 2. 房間合併功能

1. **上傳多個檔案**
   - 選擇多個房間數據的 JSON 檔案
   - 可以拖曳調整檔案順序

2. **合併數據**
   - 點擊「合併房間數據」按鈕
   - 系統會自動合併精靈和瓷磚數據
   - 下載合併後的結果

## 技術說明

### 圖片處理流程

1. **圖片載入**：使用 File API 讀取本地圖片
2. **Canvas 處理**：將圖片繪製到 Canvas 進行像素級處理
3. **二值化轉換**：將彩色圖片轉換為黑白二值圖像
4. **精靈分割**：根據設定的尺寸將圖片分割成精靈
5. **數據生成**：生成符合 Mosi 格式的 JSON 數據

### 支援的圖片格式

- PNG
- JPG/JPEG
- 其他瀏覽器支援的圖片格式

### 輸出格式

生成的 JSON 數據包含：
- 房間基本資訊（名稱、尺寸等）
- 精靈列表（包含像素數據）
- 瓷磚列表（精靈在房間中的位置）
- 腳本列表（預設為空）

## 與原版本的主要差異

| 功能 | 原版本 (Flask) | 純前端版本 |
|------|----------------|------------|
| 運行環境 | 需要 Python 伺服器 | 僅需瀏覽器 |
| 圖片處理 | 伺服器端處理 | 客戶端處理 |
| 檔案上傳 | 需要網路連接 | 完全本地處理 |
| 隱私保護 | 圖片會上傳到伺服器 | 圖片完全在本地處理 |
| 部署難度 | 需要伺服器環境 | 可直接使用 |

## 瀏覽器相容性

- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+

## 注意事項

1. **Mosi引擎限制**：房間尺寸和精靈尺寸都必須 ≤ 24
2. **圖片尺寸**：建議使用較小的圖片以獲得更好的性能
3. **精靈尺寸**：精靈尺寸必須能整除圖片尺寸
4. **房間尺寸**：房間尺寸不能超過圖片能提供的精靈數量，且必須 ≤ 24
5. **檔案大小**：過大的圖片可能會影響處理速度

## 尺寸限制說明

由於 Mosi 引擎的限制，系統會自動：
- 限制精靈尺寸在 1-24 之間
- 限制房間尺寸在 1-24 之間
- 只顯示符合限制的建議組合
- 在輸入時驗證尺寸是否合法

### 常見的尺寸組合範例

| 圖片尺寸 | 推薦組合 | 說明 |
|---------|---------|------|
| 180×180 | 9×9 房間 × 20×20 精靈 | 適合中等複雜度 |
| 256×256 | 16×16 房間 × 16×16 精靈 | 平衡的選擇 |
| 512×512 | 16×16 房間 × 32×32 精靈 | 需要縮放處理 |
| 800×600 | 20×15 房間 × 40×40 精靈 | 需要縮放處理 |
| 1500×1500 | 15×15 房間 × 100×100 精靈 | 自動縮放處理 |

## 縮放功能說明

對於不符合精確整除的圖片尺寸，系統會自動計算縮放比例：

### 縮放計算邏輯
1. **優先尋找精確匹配**：如果圖片尺寸能被精靈尺寸整除，直接使用
2. **計算縮放比例**：如果沒有精確匹配，計算最適合的縮放比例
3. **智能評分**：縮放比例越接近1，評分越高

### 縮放範例
- **1500×1500 圖片** → 15×15 房間 × 100×100 精靈 → 縮放 0.15x
- **800×600 圖片** → 20×15 房間 × 40×40 精靈 → 縮放 0.5x
- **512×512 圖片** → 16×16 房間 × 32×32 精靈 → 縮放 0.0625x

### 縮放處理特點
- 使用 nearest-neighbor 縮放算法，保持像素風格
- 自動調整圖片尺寸以符合房間和精靈尺寸要求
- 在生成的JSON中包含處理信息

## 自動計算功能

### 智能聯動計算
系統提供智能的自動計算功能，讓設定更加便捷：

#### 精靈尺寸 → 房間尺寸
- 當您修改精靈寬度或高度時
- 系統自動計算並填入對應的房間尺寸
- 計算公式：房間尺寸 = 圖片尺寸 ÷ 精靈尺寸

#### 房間尺寸 → 精靈尺寸
- 當您修改房間寬度或高度時
- 系統自動計算並填入對應的精靈尺寸
- 計算公式：精靈尺寸 = 圖片尺寸 ÷ 房間尺寸

#### 智能限制檢查
- 自動檢查計算結果是否在 Mosi 引擎限制範圍內（≤24）
- 如果超出限制，自動調整至最大可用尺寸
- 顯示警告信息提醒用戶

#### 防抖優化
- 使用 300ms 防抖延遲，避免頻繁計算
- 防止無限循環計算
- 提供流暢的用戶體驗

### 使用範例
1. 載入 256×256 圖片
2. 修改精靈寬度為 16 → 房間寬度自動變為 16
3. 修改房間高度為 12 → 精靈高度自動變為 21
4. 系統會顯示計算信息提示

## 故障排除

### 常見問題

**Q: 圖片載入失敗**
A: 檢查圖片格式是否支援，確保檔案沒有損壞

**Q: 生成數據時出現錯誤**
A: 檢查精靈尺寸和房間尺寸設定是否合理

**Q: 下載功能無法使用**
A: 確保瀏覽器允許下載檔案，某些瀏覽器可能需要手動允許

### 效能優化建議

1. 使用適當大小的圖片（建議不超過 1024x1024）
2. 選擇合適的精靈尺寸（通常 8x8 或 16x16）
3. 在較新的瀏覽器中使用以獲得最佳性能

## 授權

本工具基於原始 Mosi 圖片轉房間數據產生器改寫，保留原有的功能和設計風格。

## 聯絡資訊

如有任何問題或建議，歡迎聯繫原作者或查看原始專案頁面。 
